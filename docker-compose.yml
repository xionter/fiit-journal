version: "3.9"

services:
  server:
    build:
      context: .
      dockerfile: FiitFlow.Server/Dockerfile
    container_name: fiit-journal-server
    environment:
      - ASPNETCORE_URLS=http://0.0.0.0:8080
      - FIITFLOW_DB_PATH=/data/fiitflow.db
      - FIITFLOW_ROOT_PATH=/app
    volumes:
      - fiitflow-data:/data
      - ./cfg:/app/cfg
    expose:
      - "8080"
    restart: unless-stopped

  web:
    build:
      context: ./FiitFlow.Client
      dockerfile: Dockerfile
      args:
        - VITE_API_BASE=/api
    container_name: fiit-journal-web
    depends_on:
      - server
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    restart: unless-stopped

volumes:
  fiitflow-data:
